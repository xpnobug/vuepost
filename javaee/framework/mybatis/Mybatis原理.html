<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mybatis åŸç† | VuePress</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Vue é©±åŠ¨çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨">
    
    <link rel="preload" href="/assets/css/0.styles.443403f7.css" as="style"><link rel="preload" href="/assets/js/app.56355bfb.js" as="script"><link rel="preload" href="/assets/js/2.63cce038.js" as="script"><link rel="preload" href="/assets/js/14.b06c49c3.js" as="script"><link rel="prefetch" href="/assets/js/10.62a25884.js"><link rel="prefetch" href="/assets/js/11.4b48bc9c.js"><link rel="prefetch" href="/assets/js/12.d698a43c.js"><link rel="prefetch" href="/assets/js/13.905b4861.js"><link rel="prefetch" href="/assets/js/15.6e8c807a.js"><link rel="prefetch" href="/assets/js/16.8b770695.js"><link rel="prefetch" href="/assets/js/17.b3e4119e.js"><link rel="prefetch" href="/assets/js/18.483a87ac.js"><link rel="prefetch" href="/assets/js/19.778773e6.js"><link rel="prefetch" href="/assets/js/20.58402ec1.js"><link rel="prefetch" href="/assets/js/21.69066421.js"><link rel="prefetch" href="/assets/js/22.dac1ba48.js"><link rel="prefetch" href="/assets/js/23.50c92c21.js"><link rel="prefetch" href="/assets/js/24.c4dc0745.js"><link rel="prefetch" href="/assets/js/25.e86961e5.js"><link rel="prefetch" href="/assets/js/26.bd280195.js"><link rel="prefetch" href="/assets/js/27.56262183.js"><link rel="prefetch" href="/assets/js/28.fb5b3d5b.js"><link rel="prefetch" href="/assets/js/29.f379e8c8.js"><link rel="prefetch" href="/assets/js/3.8e8c01b1.js"><link rel="prefetch" href="/assets/js/30.cfa001ae.js"><link rel="prefetch" href="/assets/js/31.fc18ee22.js"><link rel="prefetch" href="/assets/js/32.00203410.js"><link rel="prefetch" href="/assets/js/33.117d891a.js"><link rel="prefetch" href="/assets/js/34.b7eb3e68.js"><link rel="prefetch" href="/assets/js/35.098956ae.js"><link rel="prefetch" href="/assets/js/36.59766ecd.js"><link rel="prefetch" href="/assets/js/37.c6d06b51.js"><link rel="prefetch" href="/assets/js/38.ffed810c.js"><link rel="prefetch" href="/assets/js/39.d525e97a.js"><link rel="prefetch" href="/assets/js/4.b187b210.js"><link rel="prefetch" href="/assets/js/40.ab234edd.js"><link rel="prefetch" href="/assets/js/41.e403a86b.js"><link rel="prefetch" href="/assets/js/42.e8002610.js"><link rel="prefetch" href="/assets/js/43.eec996b6.js"><link rel="prefetch" href="/assets/js/44.9dc3ddc5.js"><link rel="prefetch" href="/assets/js/45.63222b69.js"><link rel="prefetch" href="/assets/js/46.b2c81b25.js"><link rel="prefetch" href="/assets/js/47.b6f968f6.js"><link rel="prefetch" href="/assets/js/48.4a9e3424.js"><link rel="prefetch" href="/assets/js/49.3c7454d6.js"><link rel="prefetch" href="/assets/js/5.40b352b5.js"><link rel="prefetch" href="/assets/js/50.c6ea4af1.js"><link rel="prefetch" href="/assets/js/51.b75f2ec5.js"><link rel="prefetch" href="/assets/js/52.8509d480.js"><link rel="prefetch" href="/assets/js/53.dd90542c.js"><link rel="prefetch" href="/assets/js/54.00d7504b.js"><link rel="prefetch" href="/assets/js/55.15b1b158.js"><link rel="prefetch" href="/assets/js/56.db38ed2c.js"><link rel="prefetch" href="/assets/js/57.54029035.js"><link rel="prefetch" href="/assets/js/58.a99d07eb.js"><link rel="prefetch" href="/assets/js/59.5c064ae8.js"><link rel="prefetch" href="/assets/js/6.b7fe8ec2.js"><link rel="prefetch" href="/assets/js/60.9ecddb2f.js"><link rel="prefetch" href="/assets/js/61.a51bc542.js"><link rel="prefetch" href="/assets/js/62.83a28390.js"><link rel="prefetch" href="/assets/js/63.b1c77d4b.js"><link rel="prefetch" href="/assets/js/64.abf3a0bb.js"><link rel="prefetch" href="/assets/js/65.1957b797.js"><link rel="prefetch" href="/assets/js/66.a8cbebad.js"><link rel="prefetch" href="/assets/js/67.835ccafe.js"><link rel="prefetch" href="/assets/js/68.dd1b6db1.js"><link rel="prefetch" href="/assets/js/69.c2cd2888.js"><link rel="prefetch" href="/assets/js/7.a32b0d6c.js"><link rel="prefetch" href="/assets/js/70.6a3ff21c.js"><link rel="prefetch" href="/assets/js/71.bf5f0f77.js"><link rel="prefetch" href="/assets/js/72.16c8952e.js"><link rel="prefetch" href="/assets/js/73.65f6c1da.js"><link rel="prefetch" href="/assets/js/8.791fb6ea.js"><link rel="prefetch" href="/assets/js/9.92a08781.js">
    <link rel="stylesheet" href="/assets/css/0.styles.443403f7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/Hfc.gif" alt="VuePress" class="logo"> <span class="site-name can-hide">VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/theme/" class="nav-link">
  ä¸»é¢˜
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaEE" class="dropdown-title"><span class="title">JavaEE</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaEE" class="mobile-dropdown-title"><span class="title">JavaEE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaee/spring/core/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/javaee/framework/mybatis/" class="nav-link router-link-active">
  Mybatis
</a></li><li class="dropdown-subitem"><a href="/javaee/springboot/" class="nav-link">
  Spring Boot
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£" class="dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ•™ç¨‹
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/views/guide/introduction.html" class="nav-link">
  vue3
</a></li><li class="dropdown-subitem"><a href="/github/git/Git.html" class="nav-link">
  Gitæ“ä½œå‘½ä»¤è¡¨
</a></li><li class="dropdown-subitem"><a href="/echarts/e/01.html" class="nav-link">
  Apache ECharts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶å®ƒ" class="dropdown-title"><span class="title">å…¶å®ƒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…¶å®ƒ" class="mobile-dropdown-title"><span class="title">å…¶å®ƒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ProjectsğŸˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link">
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>
          Common sitesğŸˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java SE API Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.programcreek.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Program Creek
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stackoverflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BootCDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linuxå‘½ä»¤å¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeLine/" class="nav-link">
  æ—¶é—´çº¿
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/theme/" class="nav-link">
  ä¸»é¢˜
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaEE" class="dropdown-title"><span class="title">JavaEE</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaEE" class="mobile-dropdown-title"><span class="title">JavaEE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaee/spring/core/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/javaee/framework/mybatis/" class="nav-link router-link-active">
  Mybatis
</a></li><li class="dropdown-subitem"><a href="/javaee/springboot/" class="nav-link">
  Spring Boot
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£" class="dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ•™ç¨‹
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/views/guide/introduction.html" class="nav-link">
  vue3
</a></li><li class="dropdown-subitem"><a href="/github/git/Git.html" class="nav-link">
  Gitæ“ä½œå‘½ä»¤è¡¨
</a></li><li class="dropdown-subitem"><a href="/echarts/e/01.html" class="nav-link">
  Apache ECharts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶å®ƒ" class="dropdown-title"><span class="title">å…¶å®ƒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…¶å®ƒ" class="mobile-dropdown-title"><span class="title">å…¶å®ƒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ProjectsğŸˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link">
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>
          Common sitesğŸˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java SE API Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.programcreek.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Program Creek
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stackoverflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BootCDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linuxå‘½ä»¤å¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeLine/" class="nav-link">
  æ—¶é—´çº¿
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mybatis åŸç†</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-mybatis-å®Œæ•´ç¤ºä¾‹" class="sidebar-link">1. Mybatis å®Œæ•´ç¤ºä¾‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-1-æ•°æ®åº“å‡†å¤‡" class="sidebar-link">1.1. æ•°æ®åº“å‡†å¤‡</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-2-æ·»åŠ -mybatis" class="sidebar-link">1.2. æ·»åŠ  Mybatis</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-3-mybatis-é…ç½®" class="sidebar-link">1.3. Mybatis é…ç½®</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-4-mapper" class="sidebar-link">1.4. Mapper</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_1-5-æµ‹è¯•ç¨‹åº" class="sidebar-link">1.5. æµ‹è¯•ç¨‹åº</a></li></ul></li><li><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_2-mybatis-ç”Ÿå‘½å‘¨æœŸ" class="sidebar-link">2. Mybatis ç”Ÿå‘½å‘¨æœŸ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_2-1-sqlsessionfactorybuilder" class="sidebar-link">2.1. SqlSessionFactoryBuilder</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_2-2-sqlsessionfactory" class="sidebar-link">2.2. SqlSessionFactory</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_2-3-sqlsession" class="sidebar-link">2.3. SqlSession</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_2-4-æ˜ å°„å™¨" class="sidebar-link">2.4. æ˜ å°„å™¨</a></li></ul></li><li><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_3-mybatis-çš„æ¶æ„" class="sidebar-link">3. Mybatis çš„æ¶æ„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_3-1-é…ç½®å±‚" class="sidebar-link">3.1. é…ç½®å±‚</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_3-2-æ¥å£å±‚" class="sidebar-link">3.2. æ¥å£å±‚</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_3-3-æ•°æ®å¤„ç†å±‚" class="sidebar-link">3.3. æ•°æ®å¤„ç†å±‚</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_3-4-æ¡†æ¶æ”¯æ’‘å±‚" class="sidebar-link">3.4. æ¡†æ¶æ”¯æ’‘å±‚</a></li></ul></li><li><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-sqlsession-å†…éƒ¨å·¥ä½œæœºåˆ¶" class="sidebar-link">4. SqlSession å†…éƒ¨å·¥ä½œæœºåˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-1-sqlsession-å­ç»„ä»¶" class="sidebar-link">4.1. SqlSession å­ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-2-sqlsession-å’Œ-mapper" class="sidebar-link">4.2. SqlSession å’Œ Mapper</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-3-sqlsession-å’Œ-executor" class="sidebar-link">4.3. SqlSession å’Œ Executor</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-4-executor-å·¥ä½œæµç¨‹" class="sidebar-link">4.4. Executor å·¥ä½œæµç¨‹</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-5-statementhandler-å·¥ä½œæµç¨‹" class="sidebar-link">4.5. StatementHandler å·¥ä½œæµç¨‹</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-6-parameterhandler-å·¥ä½œæµç¨‹" class="sidebar-link">4.6. ParameterHandler å·¥ä½œæµç¨‹</a></li><li class="sidebar-sub-header"><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_4-7-resultsethandler-å·¥ä½œæµç¨‹" class="sidebar-link">4.7. ResultSetHandler å·¥ä½œæµç¨‹</a></li></ul></li><li><a href="/javaee/framework/mybatis/Mybatis%E5%8E%9F%E7%90%86.html#_5-å‚è€ƒèµ„æ–™" class="sidebar-link">5. å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mybatis-åŸç†"><a href="#mybatis-åŸç†" class="header-anchor">#</a> Mybatis åŸç†</h1> <blockquote><p>Mybatis çš„å‰èº«å°±æ˜¯ iBatis ï¼Œæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ª Mybatis å®Œæ•´ç¤ºä¾‹ä¸ºåˆ‡å…¥ç‚¹ï¼Œç»“åˆ Mybatis åº•å±‚æºç åˆ†æï¼Œå›¾æ–‡å¹¶èŒ‚çš„è®²è§£ Mybatis çš„æ ¸å¿ƒå·¥ä½œæœºåˆ¶ã€‚</p></blockquote> <ul><li><a href="#1-mybatis-%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B">1. Mybatis å®Œæ•´ç¤ºä¾‹</a> <ul><li><a href="#11-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87">1.1. æ•°æ®åº“å‡†å¤‡</a></li> <li><a href="#12-%E6%B7%BB%E5%8A%A0-mybatis">1.2. æ·»åŠ  Mybatis</a></li> <li><a href="#13-mybatis-%E9%85%8D%E7%BD%AE">1.3. Mybatis é…ç½®</a></li> <li><a href="#14-mapper">1.4. Mapper</a></li> <li><a href="#15-%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F">1.5. æµ‹è¯•ç¨‹åº</a></li></ul></li> <li><a href="#2-mybatis-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">2. Mybatis ç”Ÿå‘½å‘¨æœŸ</a> <ul><li><a href="#21-sqlsessionfactorybuilder">2.1. SqlSessionFactoryBuilder</a></li> <li><a href="#22-sqlsessionfactory">2.2. SqlSessionFactory</a></li> <li><a href="#23-sqlsession">2.3. SqlSession</a></li> <li><a href="#24-%E6%98%A0%E5%B0%84%E5%99%A8">2.4. æ˜ å°„å™¨</a></li></ul></li> <li><a href="#3-mybatis-%E7%9A%84%E6%9E%B6%E6%9E%84">3. Mybatis çš„æ¶æ„</a> <ul><li><a href="#31-%E9%85%8D%E7%BD%AE%E5%B1%82">3.1. é…ç½®å±‚</a></li> <li><a href="#32-%E6%8E%A5%E5%8F%A3%E5%B1%82">3.2. æ¥å£å±‚</a></li> <li><a href="#33-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%B1%82">3.3. æ•°æ®å¤„ç†å±‚</a></li> <li><a href="#34-%E6%A1%86%E6%9E%B6%E6%94%AF%E6%92%91%E5%B1%82">3.4. æ¡†æ¶æ”¯æ’‘å±‚</a></li></ul></li> <li><a href="#4-sqlsession-%E5%86%85%E9%83%A8%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6">4. SqlSession å†…éƒ¨å·¥ä½œæœºåˆ¶</a> <ul><li><a href="#41-sqlsession-%E5%AD%90%E7%BB%84%E4%BB%B6">4.1. SqlSession å­ç»„ä»¶</a></li> <li><a href="#42-sqlsession-%E5%92%8C-mapper">4.2. SqlSession å’Œ Mapper</a></li> <li><a href="#43-sqlsession-%E5%92%8C-executor">4.3. SqlSession å’Œ Executor</a></li> <li><a href="#44-executor-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">4.4. Executor å·¥ä½œæµç¨‹</a></li> <li><a href="#45-statementhandler-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">4.5. StatementHandler å·¥ä½œæµç¨‹</a></li> <li><a href="#46-parameterhandler-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">4.6. ParameterHandler å·¥ä½œæµç¨‹</a></li> <li><a href="#47-resultsethandler-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">4.7. ResultSetHandler å·¥ä½œæµç¨‹</a></li></ul></li> <li><a href="#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="_1-mybatis-å®Œæ•´ç¤ºä¾‹"><a href="#_1-mybatis-å®Œæ•´ç¤ºä¾‹" class="header-anchor">#</a> 1. Mybatis å®Œæ•´ç¤ºä¾‹</h2> <blockquote><p>è¿™é‡Œï¼Œæˆ‘å°†ä»¥ä¸€ä¸ªå…¥é—¨çº§çš„ç¤ºä¾‹æ¥æ¼”ç¤º Mybatis æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p> <p>æ³¨ï¼šæœ¬æ–‡åé¢ç« èŠ‚ä¸­çš„åŸç†ã€æºç éƒ¨åˆ†ä¹Ÿå°†åŸºäºè¿™ä¸ªç¤ºä¾‹æ¥è¿›è¡Œè®²è§£ã€‚</p> <p><a href="https://github.com/dunwu/spring-tutorial/blob/master/codes/data/spring-data-mybatis/src/main/java/io/github/dunwu/spring/orm/MybatisDemo.java" target="_blank" rel="noopener noreferrer">å®Œæ•´ç¤ºä¾‹æºç åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_1-1-æ•°æ®åº“å‡†å¤‡"><a href="#_1-1-æ•°æ®åº“å‡†å¤‡" class="header-anchor">#</a> 1.1. æ•°æ®åº“å‡†å¤‡</h3> <p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œéœ€è¦é’ˆå¯¹ä¸€å¼ ç”¨æˆ·è¡¨è¿›è¡Œ CRUD æ“ä½œã€‚å…¶æ•°æ®æ¨¡å‹å¦‚ä¸‹ï¼š</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>
    id      <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'Id'</span><span class="token punctuation">,</span>
    name    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å'</span><span class="token punctuation">,</span>
    age     <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>              <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span> <span class="token keyword">COMMENT</span> <span class="token string">'å¹´é¾„'</span><span class="token punctuation">,</span>
    address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'åœ°å€'</span><span class="token punctuation">,</span>
    email   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'é‚®ä»¶'</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'ç”¨æˆ·è¡¨'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'åŒ—äº¬'</span><span class="token punctuation">,</span> <span class="token string">'xxx@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'æå››'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">'ä¸Šæµ·'</span><span class="token punctuation">,</span> <span class="token string">'xxx@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-æ·»åŠ -mybatis"><a href="#_1-2-æ·»åŠ -mybatis" class="header-anchor">#</a> 1.2. æ·»åŠ  Mybatis</h3> <p>å¦‚æœä½¿ç”¨ Maven æ¥æ„å»ºé¡¹ç›®ï¼Œåˆ™éœ€å°†ä¸‹é¢çš„ä¾èµ–ä»£ç ç½®äº pom.xml æ–‡ä»¶ä¸­ï¼š</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.Mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_1-3-mybatis-é…ç½®"><a href="#_1-3-mybatis-é…ç½®" class="header-anchor">#</a> 1.3. Mybatis é…ç½®</h3> <p>XML é…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†å¯¹ Mybatis ç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®ï¼ŒåŒ…æ‹¬è·å–æ•°æ®åº“è¿æ¥å®ä¾‹çš„æ•°æ®æºï¼ˆDataSourceï¼‰ä»¥åŠå†³å®šäº‹åŠ¡ä½œç”¨åŸŸå’Œæ§åˆ¶æ–¹å¼çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransactionManagerï¼‰ã€‚</p> <p>æœ¬ç¤ºä¾‹ä¸­åªæ˜¯ç»™å‡ºæœ€ç®€åŒ–çš„é…ç½®ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘Mybatis-config.xml æ–‡ä»¶</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//Mybatis.org//DTD Config 3.0//EN&quot;</span>
  <span class="token string">&quot;http://Mybatis.org/dtd/Mybatis-3-config.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span>
                  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://127.0.0.1:3306/spring_tutorial?serverTimezone=UTC<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Mybatis/mapper/UserMapper.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>è¯´æ˜ï¼šä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ä»…ä»…æŒ‡å®šäº†æ•°æ®æºè¿æ¥æ–¹å¼å’Œ User è¡¨çš„æ˜ å°„é…ç½®æ–‡ä»¶ã€‚</p></blockquote> <h3 id="_1-4-mapper"><a href="#_1-4-mapper" class="header-anchor">#</a> 1.4. Mapper</h3> <h4 id="mapper-xml"><a href="#mapper-xml" class="header-anchor">#</a> Mapper.xml</h4> <p>ä¸ªäººç†è§£ï¼ŒMapper.xml æ–‡ä»¶å¯ä»¥çœ‹åšæ˜¯ Mybatis çš„ JDBC SQL æ¨¡æ¿ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘UserMapper.xml æ–‡ä»¶</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡ Mybatis Generator è‡ªåŠ¨ç”Ÿæˆçš„å®Œæ•´çš„ Mapper æ–‡ä»¶ã€‚</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//Mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://Mybatis.org/dtd/Mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.dunwu.spring.orm.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.dunwu.spring.orm.entity.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VARCHAR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VARCHAR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VARCHAR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteByPrimaryKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    delete from user
    where id = #{id,jdbcType=BIGINT}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.dunwu.spring.orm.entity.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    insert into user (id, name, age,
      address, email)
    values (#{id,jdbcType=BIGINT}, #{name,jdbcType=VARCHAR}, #{age,jdbcType=INTEGER},
      #{address,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR})
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateByPrimaryKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.dunwu.spring.orm.entity.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    update user
    set name = #{name,jdbcType=VARCHAR},
      age = #{age,jdbcType=INTEGER},
      address = #{address,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectByPrimaryKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select id, name, age, address, email
    from user
    where id = #{id,jdbcType=BIGINT}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select id, name, age, address, email
    from user
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="mapper-java"><a href="#mapper-java" class="header-anchor">#</a> Mapper.java</h4> <p>Mapper.java æ–‡ä»¶æ˜¯ Mapper.xml å¯¹åº”çš„ Java å¯¹è±¡ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘UserMapper.java æ–‡ä»¶</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> <span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">updateByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">User</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹æ¯” UserMapper.java å’Œ UserMapper.xml æ–‡ä»¶ï¼Œä¸éš¾å‘ç°ï¼š</p> <p>UserMapper.java ä¸­çš„æ–¹æ³•å’Œ UserMapper.xml çš„ CRUD è¯­å¥å…ƒç´ ï¼ˆ <code>&lt;insert&gt;</code>ã€<code>&lt;delete&gt;</code>ã€<code>&lt;update&gt;</code>ã€<code>&lt;select&gt;</code>ï¼‰å­˜åœ¨ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚</p> <p>åœ¨ Mybatis ä¸­ï¼Œæ­£æ˜¯é€šè¿‡æ–¹æ³•çš„å…¨é™å®šåï¼Œå°†äºŒè€…ç»‘å®šåœ¨ä¸€èµ·ã€‚</p> <h4 id="æ•°æ®å®ä½“-java"><a href="#æ•°æ®å®ä½“-java" class="header-anchor">#</a> æ•°æ®å®ä½“.java</h4> <p>ã€ç¤ºä¾‹ã€‘User.java æ–‡ä»¶</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>&lt;insert&gt;</code>ã€<code>&lt;delete&gt;</code>ã€<code>&lt;update&gt;</code>ã€<code>&lt;select&gt;</code> çš„ <code>parameterType</code> å±æ€§ä»¥åŠ <code>&lt;resultMap&gt;</code> çš„ <code>type</code> å±æ€§éƒ½å¯èƒ½ä¼šç»‘å®šåˆ°æ•°æ®å®ä½“ã€‚è¿™æ ·å°±å¯ä»¥æŠŠ JDBC æ“ä½œçš„è¾“å…¥è¾“å‡ºå’Œ JavaBean ç»“åˆèµ·æ¥ï¼Œæ›´åŠ æ–¹ä¾¿ã€æ˜“äºç†è§£ã€‚</p> <h3 id="_1-5-æµ‹è¯•ç¨‹åº"><a href="#_1-5-æµ‹è¯•ç¨‹åº" class="header-anchor">#</a> 1.5. æµ‹è¯•ç¨‹åº</h3> <p>ã€ç¤ºä¾‹ã€‘MybatisDemo.java æ–‡ä»¶</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. åŠ è½½ Mybatis é…ç½®æ–‡ä»¶ï¼Œåˆ›å»º SqlSessionFactory</span>
        <span class="token comment">// æ³¨ï¼šåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼ŒSqlSessionFactory åº”è¯¥æ˜¯å•ä¾‹</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;Mybatis/Mybatis-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactoryBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. åˆ›å»ºä¸€ä¸ª SqlSession å®ä¾‹ï¼Œè¿›è¡Œæ•°æ®åº“æ“ä½œ</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. Mapper æ˜ å°„å¹¶æ‰§è¡Œ</span>
        <span class="token class-name">Long</span> params <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">&quot;io.github.dunwu.spring.orm.mapper.UserMapper.selectByPrimaryKey&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;user name: &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è¾“å‡ºï¼šuser name: å¼ ä¸‰</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯´æ˜ï¼š</p> <p><code>SqlSession</code> æ¥å£æ˜¯ Mybatis API æ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œå®ƒä»£è¡¨äº† Mybatis å’Œæ•°æ®åº“çš„ä¸€æ¬¡å®Œæ•´ä¼šè¯ã€‚</p> <ul><li>Mybatis ä¼šè§£æé…ç½®ï¼Œå¹¶æ ¹æ®é…ç½®åˆ›å»º <code>SqlSession</code> ã€‚</li> <li>ç„¶åï¼ŒMybatis å°† Mapper æ˜ å°„ä¸º <code>SqlSession</code>ï¼Œç„¶åä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œ SQL è¯­å¥å¹¶è·å–ç»“æœã€‚</li></ul></blockquote> <h2 id="_2-mybatis-ç”Ÿå‘½å‘¨æœŸ"><a href="#_2-mybatis-ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> 2. Mybatis ç”Ÿå‘½å‘¨æœŸ</h2> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210510113446.png" alt=""></p> <h3 id="_2-1-sqlsessionfactorybuilder"><a href="#_2-1-sqlsessionfactorybuilder" class="header-anchor">#</a> 2.1. SqlSessionFactoryBuilder</h3> <h4 id="sqlsessionfactorybuilder-çš„èŒè´£"><a href="#sqlsessionfactorybuilder-çš„èŒè´£" class="header-anchor">#</a> SqlSessionFactoryBuilder çš„èŒè´£</h4> <p><strong><code>SqlSessionFactoryBuilder</code> è´Ÿè´£åˆ›å»º <code>SqlSessionFactory</code> å®ä¾‹</strong>ã€‚<code>SqlSessionFactoryBuilder</code> å¯ä»¥ä» XML é…ç½®æ–‡ä»¶æˆ–ä¸€ä¸ªé¢„å…ˆå®šåˆ¶çš„ <code>Configuration</code> çš„å®ä¾‹æ„å»ºå‡º <code>SqlSessionFactory</code> çš„å®ä¾‹ã€‚</p> <p><code>Configuration</code> ç±»åŒ…å«äº†å¯¹ä¸€ä¸ª <code>SqlSessionFactory</code> å®ä¾‹ä½ å¯èƒ½å…³å¿ƒçš„æ‰€æœ‰å†…å®¹ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210508173040.png" alt=""></p> <p><code>SqlSessionFactoryBuilder</code> åº”ç”¨äº†å»ºé€ è€…è®¾è®¡æ¨¡å¼ï¼Œå®ƒæœ‰äº”ä¸ª <code>build</code> æ–¹æ³•ï¼Œå…è®¸ä½ é€šè¿‡ä¸åŒçš„èµ„æºåˆ›å»º <code>SqlSessionFactory</code> å®ä¾‹ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span>
<span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span> <span class="token class-name">String</span> environment<span class="token punctuation">)</span>
<span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">)</span>
<span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span> <span class="token class-name">String</span> env<span class="token punctuation">,</span> <span class="token class-name">Properties</span> props<span class="token punctuation">)</span>
<span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> config<span class="token punctuation">)</span>
</code></pre></div><h4 id="sqlsessionfactorybuilder-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#sqlsessionfactorybuilder-çš„ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> SqlSessionFactoryBuilder çš„ç”Ÿå‘½å‘¨æœŸ</h4> <p><code>SqlSessionFactoryBuilder</code> å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œä¸€æ—¦åˆ›å»ºäº† <code>SqlSessionFactory</code>ï¼Œå°±ä¸å†éœ€è¦å®ƒäº†ã€‚ å› æ­¤ <code>SqlSessionFactoryBuilder</code> å®ä¾‹çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯æ–¹æ³•ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯å±€éƒ¨æ–¹æ³•å˜é‡ï¼‰ã€‚ä½ å¯ä»¥é‡ç”¨ <code>SqlSessionFactoryBuilder</code> æ¥åˆ›å»ºå¤šä¸ª <code>SqlSessionFactory</code> å®ä¾‹ï¼Œä½†æœ€å¥½è¿˜æ˜¯ä¸è¦ä¸€ç›´ä¿ç•™ç€å®ƒï¼Œä»¥ä¿è¯æ‰€æœ‰çš„ XML è§£æèµ„æºå¯ä»¥è¢«é‡Šæ”¾ç»™æ›´é‡è¦çš„äº‹æƒ…ã€‚</p> <h3 id="_2-2-sqlsessionfactory"><a href="#_2-2-sqlsessionfactory" class="header-anchor">#</a> 2.2. SqlSessionFactory</h3> <h4 id="sqlsessionfactory-èŒè´£"><a href="#sqlsessionfactory-èŒè´£" class="header-anchor">#</a> SqlSessionFactory èŒè´£</h4> <p><strong><code>SqlSessionFactory</code> è´Ÿè´£åˆ›å»º <code>SqlSession</code> å®ä¾‹ã€‚</strong></p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210510105641.png" alt=""></p> <p><code>SqlSessionFactory</code> åº”ç”¨äº†å·¥å‚è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨äºåˆ›å»º SqlSession å®ä¾‹ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> autoCommit<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">TransactionIsolationLevel</span> level<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">ExecutorType</span> execType<span class="token punctuation">,</span> <span class="token class-name">TransactionIsolationLevel</span> level<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">ExecutorType</span> execType<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">ExecutorType</span> execType<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoCommit<span class="token punctuation">)</span>
<span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token class-name">ExecutorType</span> execType<span class="token punctuation">,</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">)</span>
<span class="token class-name">Configuration</span> <span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ–¹æ³•è¯´æ˜ï¼š</p> <ul><li>é»˜è®¤çš„ <code>openSession()</code> æ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šåˆ›å»ºå…·å¤‡å¦‚ä¸‹ç‰¹æ€§çš„ <code>SqlSession</code>ï¼š
<ul><li>äº‹åŠ¡ä½œç”¨åŸŸå°†ä¼šå¼€å¯ï¼ˆä¹Ÿå°±æ˜¯ä¸è‡ªåŠ¨æäº¤ï¼‰ã€‚</li> <li>å°†ç”±å½“å‰ç¯å¢ƒé…ç½®çš„ <code>DataSource</code> å®ä¾‹ä¸­è·å– <code>Connection</code> å¯¹è±¡ã€‚</li> <li>äº‹åŠ¡éš”ç¦»çº§åˆ«å°†ä¼šä½¿ç”¨é©±åŠ¨æˆ–æ•°æ®æºçš„é»˜è®¤è®¾ç½®ã€‚</li> <li>é¢„å¤„ç†è¯­å¥ä¸ä¼šè¢«å¤ç”¨ï¼Œä¹Ÿä¸ä¼šæ‰¹é‡å¤„ç†æ›´æ–°ã€‚</li></ul></li> <li><code>TransactionIsolationLevel</code> è¡¨ç¤ºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒå¯¹åº”ç€ JDBC çš„äº”ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</li> <li><code>ExecutorType</code> æšä¸¾ç±»å‹å®šä¹‰äº†ä¸‰ä¸ªå€¼:
<ul><li><code>ExecutorType.SIMPLE</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨æ²¡æœ‰ç‰¹åˆ«çš„è¡Œä¸ºã€‚å®ƒä¸ºæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¢„å¤„ç†è¯­å¥ã€‚</li> <li><code>ExecutorType.REUSE</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨ä¼šå¤ç”¨é¢„å¤„ç†è¯­å¥ã€‚</li> <li><code>ExecutorType.BATCH</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨ä¼šæ‰¹é‡æ‰§è¡Œæ‰€æœ‰æ›´æ–°è¯­å¥ï¼Œå¦‚æœ SELECT åœ¨å¤šä¸ªæ›´æ–°ä¸­é—´æ‰§è¡Œï¼Œå°†åœ¨å¿…è¦æ—¶å°†å¤šæ¡æ›´æ–°è¯­å¥åˆ†éš”å¼€æ¥ï¼Œä»¥æ–¹ä¾¿ç†è§£ã€‚</li></ul></li></ul> <h4 id="sqlsessionfactory-ç”Ÿå‘½å‘¨æœŸ"><a href="#sqlsessionfactory-ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> SqlSessionFactory ç”Ÿå‘½å‘¨æœŸ</h4> <p><code>SqlSessionFactory</code> åº”è¯¥ä»¥å•ä¾‹å½¢å¼åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ã€‚</p> <h3 id="_2-3-sqlsession"><a href="#_2-3-sqlsession" class="header-anchor">#</a> 2.3. SqlSession</h3> <h4 id="sqlsession-èŒè´£"><a href="#sqlsession-èŒè´£" class="header-anchor">#</a> SqlSession èŒè´£</h4> <p><strong>Mybatis çš„ä¸»è¦ Java æ¥å£å°±æ˜¯ <code>SqlSession</code>ã€‚å®ƒåŒ…å«äº†æ‰€æœ‰æ‰§è¡Œè¯­å¥ï¼Œè·å–æ˜ å°„å™¨å’Œç®¡ç†äº‹åŠ¡ç­‰æ–¹æ³•ã€‚</strong></p> <blockquote><p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼šã€Œ <a href="http://www.Mybatis.org/Mybatis-3/zh/java-api.html#sqlSessions" target="_blank" rel="noopener noreferrer">Mybatis å®˜æ–¹æ–‡æ¡£ä¹‹ SqlSessions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ã€ ã€‚</p></blockquote> <p>SqlSession ç±»çš„æ–¹æ³•å¯ä»¥æŒ‰ç…§ä¸‹å›¾è¿›è¡Œå¤§è‡´åˆ†ç±»ï¼š</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210510110638.png" alt=""></p> <h4 id="sqlsession-ç”Ÿå‘½å‘¨æœŸ"><a href="#sqlsession-ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> SqlSession ç”Ÿå‘½å‘¨æœŸ</h4> <p><code>SqlSessions</code> æ˜¯ç”± <code>SqlSessionFactory</code> å®ä¾‹åˆ›å»ºçš„ï¼›è€Œ <code>SqlSessionFactory</code> æ˜¯ç”± <code>SqlSessionFactoryBuilder</code> åˆ›å»ºçš„ã€‚</p> <blockquote><p>ğŸ”” æ³¨æ„ï¼šå½“ Mybatis ä¸ä¸€äº›ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚ Spring æˆ–è€… Guiceï¼‰åŒæ—¶ä½¿ç”¨æ—¶ï¼Œ<code>SqlSessions</code> å°†è¢«ä¾èµ–æ³¨å…¥æ¡†æ¶æ‰€åˆ›å»ºï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ä½¿ç”¨ <code>SqlSessionFactoryBuilder</code> æˆ–è€… <code>SqlSessionFactory</code>ã€‚</p></blockquote> <p><strong>æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„ <code>SqlSession</code> å®ä¾‹ã€‚</strong></p> <p><code>SqlSession</code> çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„ä½œç”¨åŸŸæ˜¯è¯·æ±‚æˆ–æ–¹æ³•ä½œç”¨åŸŸã€‚ ç»å¯¹ä¸èƒ½å°† <code>SqlSession</code> å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä¸€ä¸ªç±»çš„é™æ€åŸŸï¼Œç”šè‡³ä¸€ä¸ªç±»çš„å®ä¾‹å˜é‡ä¹Ÿä¸è¡Œã€‚ ä¹Ÿç»ä¸èƒ½å°† <code>SqlSession</code> å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä»»ä½•ç±»å‹çš„æ‰˜ç®¡ä½œç”¨åŸŸä¸­ï¼Œæ¯”å¦‚ Servlet æ¡†æ¶ä¸­çš„ <code>HttpSession</code>ã€‚ æ­£ç¡®åœ¨ Web ä¸­ä½¿ç”¨ <code>SqlSession</code> çš„åœºæ™¯æ˜¯ï¼šæ¯æ¬¡æ”¶åˆ°çš„ HTTP è¯·æ±‚ï¼Œå°±å¯ä»¥æ‰“å¼€ä¸€ä¸ª <code>SqlSession</code>ï¼Œè¿”å›ä¸€ä¸ªå“åº”ï¼Œå°±å…³é—­å®ƒã€‚</p> <p>ç¼–ç¨‹æ¨¡å¼ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä½ çš„åº”ç”¨é€»è¾‘ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-4-æ˜ å°„å™¨"><a href="#_2-4-æ˜ å°„å™¨" class="header-anchor">#</a> 2.4. æ˜ å°„å™¨</h3> <h4 id="æ˜ å°„å™¨èŒè´£"><a href="#æ˜ å°„å™¨èŒè´£" class="header-anchor">#</a> æ˜ å°„å™¨èŒè´£</h4> <p>æ˜ å°„å™¨æ˜¯ä¸€äº›ç”±ç”¨æˆ·åˆ›å»ºçš„ã€ç»‘å®š SQL è¯­å¥çš„æ¥å£ã€‚</p> <p><code>SqlSession</code> ä¸­çš„ <code>insert</code>ã€<code>update</code>ã€<code>delete</code> å’Œ <code>select</code> æ–¹æ³•éƒ½å¾ˆå¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰äº›ç¹çã€‚æ›´é€šç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨æ˜ å°„å™¨ç±»æ¥æ‰§è¡Œæ˜ å°„è¯­å¥ã€‚<strong>ä¸€ä¸ªæ˜ å°„å™¨ç±»å°±æ˜¯ä¸€ä¸ªä»…éœ€å£°æ˜ä¸ <code>SqlSession</code> æ–¹æ³•ç›¸åŒ¹é…çš„æ–¹æ³•çš„æ¥å£ç±»</strong>ã€‚</p> <p>Mybatis å°†é…ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ª <code>&lt;mapper&gt;</code> èŠ‚ç‚¹æŠ½è±¡ä¸ºä¸€ä¸ª <code>Mapper</code> æ¥å£ï¼Œè€Œè¿™ä¸ªæ¥å£ä¸­å£°æ˜çš„æ–¹æ³•å’Œè·Ÿ <code>&lt;mapper&gt;</code> èŠ‚ç‚¹ä¸­çš„ <code>&lt;select|update|delete|insert&gt;</code> èŠ‚ç‚¹ç›¸å¯¹åº”ï¼Œå³ <code>&lt;select|update|delete|insert&gt;</code> èŠ‚ç‚¹çš„ id å€¼ä¸º Mapper æ¥å£ä¸­çš„æ–¹æ³•åç§°ï¼Œ<code>parameterType</code> å€¼è¡¨ç¤º Mapper å¯¹åº”æ–¹æ³•çš„å…¥å‚ç±»å‹ï¼Œè€Œ <code>resultMap</code> å€¼åˆ™å¯¹åº”äº† Mapper æ¥å£è¡¨ç¤ºçš„è¿”å›å€¼ç±»å‹æˆ–è€…è¿”å›ç»“æœé›†çš„å…ƒç´ ç±»å‹ã€‚</p> <p>Mybatis ä¼šæ ¹æ®ç›¸åº”çš„æ¥å£å£°æ˜çš„æ–¹æ³•ä¿¡æ¯ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶ç”Ÿæˆä¸€ä¸ª Mapper å®ä¾‹ï¼›Mybatis ä¼šæ ¹æ®è¿™ä¸ªæ–¹æ³•çš„æ–¹æ³•åå’Œå‚æ•°ç±»å‹ï¼Œç¡®å®š Statement Idï¼Œç„¶åå’Œ SqlSession è¿›è¡Œæ˜ å°„ï¼Œåº•å±‚è¿˜æ˜¯é€šè¿‡ SqlSession å®Œæˆå’Œæ•°æ®åº“çš„äº¤äº’ã€‚</p> <p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€äº›æ–¹æ³•ç­¾åä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•æ˜ å°„åˆ° <code>SqlSession</code> ä¸Šçš„ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512111723.png" alt=""></p> <blockquote><p><strong>æ³¨æ„</strong></p> <ul><li>æ˜ å°„å™¨æ¥å£ä¸éœ€è¦å»å®ç°ä»»ä½•æ¥å£æˆ–ç»§æ‰¿è‡ªä»»ä½•ç±»ã€‚åªè¦æ–¹æ³•å¯ä»¥è¢«å”¯ä¸€æ ‡è¯†å¯¹åº”çš„æ˜ å°„è¯­å¥å°±å¯ä»¥äº†ã€‚</li> <li>æ˜ å°„å™¨æ¥å£å¯ä»¥ç»§æ‰¿è‡ªå…¶ä»–æ¥å£ã€‚å½“ä½¿ç”¨ XML æ¥æ„å»ºæ˜ å°„å™¨æ¥å£æ—¶è¦ä¿è¯è¯­å¥è¢«åŒ…å«åœ¨åˆé€‚çš„å‘½åç©ºé—´ä¸­ã€‚è€Œä¸”ï¼Œå”¯ä¸€çš„é™åˆ¶å°±æ˜¯ä½ ä¸èƒ½åœ¨ä¸¤ä¸ªç»§æ‰¿å…³ç³»çš„æ¥å£ä¸­æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾åï¼ˆæ½œåœ¨çš„å±é™©åšæ³•ä¸å¯å–ï¼‰ã€‚</li></ul></blockquote> <h4 id="æ˜ å°„å™¨ç”Ÿå‘½å‘¨æœŸ"><a href="#æ˜ å°„å™¨ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> æ˜ å°„å™¨ç”Ÿå‘½å‘¨æœŸ</h4> <p>æ˜ å°„å™¨æ¥å£çš„å®ä¾‹æ˜¯ä» <code>SqlSession</code> ä¸­è·å¾—çš„ã€‚å› æ­¤ä»æŠ€æœ¯å±‚é¢è®²ï¼Œä»»ä½•æ˜ å°„å™¨å®ä¾‹çš„æœ€å¤§ä½œç”¨åŸŸæ˜¯å’Œè¯·æ±‚å®ƒä»¬çš„ <code>SqlSession</code> ç›¸åŒçš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ˜ å°„å™¨å®ä¾‹çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯æ–¹æ³•ä½œç”¨åŸŸã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜ å°„å™¨å®ä¾‹åº”è¯¥åœ¨è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ä¸­è¢«è¯·æ±‚ï¼Œç”¨è¿‡ä¹‹åå³å¯ä¸¢å¼ƒã€‚</p> <p>ç¼–ç¨‹æ¨¡å¼ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">BlogMapper</span> mapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">BlogMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ä½ çš„åº”ç”¨é€»è¾‘ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>æ˜ å°„å™¨æ³¨è§£</strong></li></ul> <p>Mybatis æ˜¯ä¸€ä¸ª XML é©±åŠ¨çš„æ¡†æ¶ã€‚é…ç½®ä¿¡æ¯æ˜¯åŸºäº XML çš„ï¼Œè€Œä¸”æ˜ å°„è¯­å¥ä¹Ÿæ˜¯å®šä¹‰åœ¨ XML ä¸­çš„ã€‚Mybatis 3 ä»¥åï¼Œæ”¯æŒæ³¨è§£é…ç½®ã€‚æ³¨è§£é…ç½®åŸºäºé…ç½® APIï¼›è€Œé…ç½® API åŸºäº XML é…ç½®ã€‚</p> <p>Mybatis æ”¯æŒè¯¸å¦‚ <code>@Insert</code>ã€<code>@Update</code>ã€<code>@Delete</code>ã€<code>@Select</code>ã€<code>@Result</code> ç­‰æ³¨è§£ã€‚</p> <blockquote><p>è¯¦ç»†å†…å®¹è¯·å‚è€ƒï¼š<a href="http://www.Mybatis.org/Mybatis-3/zh/java-api.html#sqlSessions" target="_blank" rel="noopener noreferrer">Mybatis å®˜æ–¹æ–‡æ¡£ä¹‹ sqlSessions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œå…¶ä¸­åˆ—ä¸¾äº† Mybatis æ”¯æŒçš„æ³¨è§£æ¸…å•ï¼Œä»¥åŠåŸºæœ¬ç”¨æ³•ã€‚</p></blockquote> <h2 id="_3-mybatis-çš„æ¶æ„"><a href="#_3-mybatis-çš„æ¶æ„" class="header-anchor">#</a> 3. Mybatis çš„æ¶æ„</h2> <p>ä» Mybatis ä»£ç å®ç°çš„è§’åº¦æ¥çœ‹ï¼ŒMybatis çš„ä¸»è¦ç»„ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p> <ul><li><strong>SqlSession</strong> - ä½œä¸º Mybatis å·¥ä½œçš„ä¸»è¦é¡¶å±‚ APIï¼Œè¡¨ç¤ºå’Œæ•°æ®åº“äº¤äº’çš„ä¼šè¯ï¼Œå®Œæˆå¿…è¦æ•°æ®åº“å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚</li> <li><strong>Executor</strong> - Mybatis æ‰§è¡Œå™¨ï¼Œæ˜¯ Mybatis è°ƒåº¦çš„æ ¸å¿ƒï¼Œè´Ÿè´£ SQL è¯­å¥çš„ç”Ÿæˆå’ŒæŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚</li> <li><strong>StatementHandler</strong> - å°è£…äº† JDBC Statement æ“ä½œï¼Œè´Ÿè´£å¯¹ JDBC statement çš„æ“ä½œï¼Œå¦‚è®¾ç½®å‚æ•°ã€å°† Statement ç»“æœé›†è½¬æ¢æˆ List é›†åˆã€‚</li> <li><strong>ParameterHandler</strong> - è´Ÿè´£å¯¹ç”¨æˆ·ä¼ é€’çš„å‚æ•°è½¬æ¢æˆ JDBC Statement æ‰€éœ€è¦çš„å‚æ•°ã€‚</li> <li><strong>ResultSetHandler</strong> - è´Ÿè´£å°† JDBC è¿”å›çš„ ResultSet ç»“æœé›†å¯¹è±¡è½¬æ¢æˆ List ç±»å‹çš„é›†åˆã€‚</li> <li><strong>TypeHandler</strong> - è´Ÿè´£ java æ•°æ®ç±»å‹å’Œ jdbc æ•°æ®ç±»å‹ä¹‹é—´çš„æ˜ å°„å’Œè½¬æ¢ã€‚</li> <li><strong>MappedStatement</strong> - <code>MappedStatement</code> ç»´æŠ¤äº†ä¸€æ¡ <code>&lt;select|update|delete|insert&gt;</code> èŠ‚ç‚¹çš„å°è£…ã€‚</li> <li><strong>SqlSource</strong> - è´Ÿè´£æ ¹æ®ç”¨æˆ·ä¼ é€’çš„ parameterObjectï¼ŒåŠ¨æ€åœ°ç”Ÿæˆ SQL è¯­å¥ï¼Œå°†ä¿¡æ¯å°è£…åˆ° BoundSql å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›ã€‚</li> <li><strong>BoundSql</strong> - è¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯ã€‚</li> <li><strong>Configuration</strong> - Mybatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ã€‚</li></ul> <p>è¿™äº›ç»„ä»¶çš„æ¶æ„å±‚æ¬¡å¦‚ä¸‹ï¼š</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512114852.png" alt=""></p> <h3 id="_3-1-é…ç½®å±‚"><a href="#_3-1-é…ç½®å±‚" class="header-anchor">#</a> 3.1. é…ç½®å±‚</h3> <p>é…ç½®å±‚å†³å®šäº† Mybatis çš„å·¥ä½œæ–¹å¼ã€‚</p> <p>Mybatis æä¾›äº†ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p> <ul><li>åŸºäº XML é…ç½®æ–‡ä»¶çš„æ–¹å¼</li> <li>åŸºäº Java API çš„æ–¹å¼</li></ul> <p><code>SqlSessionFactoryBuilder</code> ä¼šæ ¹æ®é…ç½®åˆ›å»º <code>SqlSessionFactory</code> ï¼›</p> <p><code>SqlSessionFactory</code> è´Ÿè´£åˆ›å»º <code>SqlSessions</code> ã€‚</p> <h3 id="_3-2-æ¥å£å±‚"><a href="#_3-2-æ¥å£å±‚" class="header-anchor">#</a> 3.2. æ¥å£å±‚</h3> <p>æ¥å£å±‚è´Ÿè´£å’Œæ•°æ®åº“äº¤äº’çš„æ–¹å¼ã€‚</p> <p>Mybatis å’Œæ•°æ®åº“çš„äº¤äº’æœ‰ä¸¤ç§æ–¹å¼ï¼š</p> <ul><li><strong>ä½¿ç”¨ SqlSession</strong>ï¼šSqlSession å°è£…äº†æ‰€æœ‰æ‰§è¡Œè¯­å¥ï¼Œè·å–æ˜ å°„å™¨å’Œç®¡ç†äº‹åŠ¡çš„æ–¹æ³•ã€‚
<ul><li>ç”¨æˆ·åªéœ€è¦ä¼ å…¥ Statement Id å’ŒæŸ¥è¯¢å‚æ•°ç»™ SqlSession å¯¹è±¡ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚</li> <li>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¸ç¬¦åˆé¢å‘å¯¹è±¡ç¼–ç¨‹çš„èŒƒå¼ã€‚</li></ul></li> <li><strong>ä½¿ç”¨ Mapper æ¥å£</strong>ï¼šMybatis ä¼šæ ¹æ®ç›¸åº”çš„æ¥å£å£°æ˜çš„æ–¹æ³•ä¿¡æ¯ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶ç”Ÿæˆä¸€ä¸ª Mapper å®ä¾‹ï¼›Mybatis ä¼šæ ¹æ®è¿™ä¸ªæ–¹æ³•çš„æ–¹æ³•åå’Œå‚æ•°ç±»å‹ï¼Œç¡®å®š Statement Idï¼Œç„¶åå’Œ SqlSession è¿›è¡Œæ˜ å°„ï¼Œåº•å±‚è¿˜æ˜¯é€šè¿‡ SqlSession å®Œæˆå’Œæ•°æ®åº“çš„äº¤äº’ã€‚</li></ul> <h3 id="_3-3-æ•°æ®å¤„ç†å±‚"><a href="#_3-3-æ•°æ®å¤„ç†å±‚" class="header-anchor">#</a> 3.3. æ•°æ®å¤„ç†å±‚</h3> <p>æ•°æ®å¤„ç†å±‚å¯ä»¥è¯´æ˜¯ Mybatis çš„æ ¸å¿ƒï¼Œä»å¤§çš„æ–¹é¢ä¸Šè®²ï¼Œå®ƒè¦å®Œæˆä¸¤ä¸ªåŠŸèƒ½ï¼š</p> <ul><li>æ ¹æ®ä¼ å‚ <code>Statement</code> å’Œå‚æ•°æ„å»ºåŠ¨æ€ SQL è¯­å¥
<ul><li>åŠ¨æ€è¯­å¥ç”Ÿæˆå¯ä»¥è¯´æ˜¯ Mybatis æ¡†æ¶éå¸¸ä¼˜é›…çš„ä¸€ä¸ªè®¾è®¡ï¼ŒMybatis é€šè¿‡ä¼ å…¥çš„å‚æ•°å€¼ï¼Œ<strong>ä½¿ç”¨ Ognl æ¥åŠ¨æ€åœ°æ„é€  SQL è¯­å¥</strong>ï¼Œä½¿å¾— Mybatis æœ‰å¾ˆå¼ºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</li> <li>å‚æ•°æ˜ å°„æŒ‡çš„æ˜¯å¯¹äº java æ•°æ®ç±»å‹å’Œ jdbc æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼šè¿™é‡Œæœ‰åŒ…æ‹¬ä¸¤ä¸ªè¿‡ç¨‹ï¼šæŸ¥è¯¢é˜¶æ®µï¼Œæˆ‘ä»¬è¦å°† java ç±»å‹çš„æ•°æ®ï¼Œè½¬æ¢æˆ jdbc ç±»å‹çš„æ•°æ®ï¼Œé€šè¿‡ <code>preparedStatement.setXXX()</code> æ¥è®¾å€¼ï¼›å¦ä¸€ä¸ªå°±æ˜¯å¯¹ resultset æŸ¥è¯¢ç»“æœé›†çš„ jdbcType æ•°æ®è½¬æ¢æˆ java æ•°æ®ç±»å‹ã€‚</li></ul></li> <li>æ‰§è¡Œ SQL è¯­å¥ä»¥åŠå¤„ç†å“åº”ç»“æœé›† ResultSet
<ul><li>åŠ¨æ€ SQL è¯­å¥ç”Ÿæˆä¹‹åï¼ŒMybatis å°†æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶å°†å¯èƒ½è¿”å›çš„ç»“æœé›†è½¬æ¢æˆ <code>List&lt;E&gt;</code> åˆ—è¡¨ã€‚</li> <li>Mybatis åœ¨å¯¹ç»“æœé›†çš„å¤„ç†ä¸­ï¼Œæ”¯æŒç»“æœé›†å…³ç³»ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€çš„è½¬æ¢ï¼Œå¹¶ä¸”æœ‰ä¸¤ç§æ”¯æŒæ–¹å¼ï¼Œä¸€ç§ä¸ºåµŒå¥—æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯åµŒå¥—ç»“æœé›†çš„æŸ¥è¯¢ã€‚</li></ul></li></ul> <h3 id="_3-4-æ¡†æ¶æ”¯æ’‘å±‚"><a href="#_3-4-æ¡†æ¶æ”¯æ’‘å±‚" class="header-anchor">#</a> 3.4. æ¡†æ¶æ”¯æ’‘å±‚</h3> <ul><li><p><strong>äº‹åŠ¡ç®¡ç†æœºåˆ¶</strong> - Mybatis å°†äº‹åŠ¡æŠ½è±¡æˆäº† Transaction æ¥å£ã€‚Mybatis çš„äº‹åŠ¡ç®¡ç†åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š</p> <ul><li>ä½¿ç”¨ JDBC çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼šå³åˆ©ç”¨ <code>java.sql.Connection</code> å¯¹è±¡å®Œæˆå¯¹äº‹åŠ¡çš„æäº¤ï¼ˆ<code>commit</code>ï¼‰ã€å›æ»šï¼ˆ<code>rollback</code>ï¼‰ã€å…³é—­ï¼ˆ<code>close</code>ï¼‰ç­‰ã€‚</li> <li>ä½¿ç”¨ MANAGED çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼šMybatis è‡ªèº«ä¸ä¼šå»å®ç°äº‹åŠ¡ç®¡ç†ï¼Œè€Œæ˜¯è®©ç¨‹åºçš„å®¹å™¨å¦‚ï¼ˆJBOSSï¼ŒWeblogicï¼‰æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ã€‚</li></ul></li> <li><p><strong>è¿æ¥æ± ç®¡ç†</strong></p></li> <li><p><strong>SQL è¯­å¥çš„é…ç½®</strong> - æ”¯æŒä¸¤ç§æ–¹å¼ï¼š</p> <ul><li>xml é…ç½®</li> <li>æ³¨è§£é…ç½®</li></ul></li> <li><p>ç¼“å­˜æœºåˆ¶ - Mybatis é‡‡ç”¨ä¸¤çº§ç¼“å­˜ç»“æ„</p> <ul><li><strong>ä¸€çº§ç¼“å­˜æ˜¯ Session ä¼šè¯çº§åˆ«çš„ç¼“å­˜</strong> - ä¸€çº§ç¼“å­˜åˆè¢«ç§°ä¹‹ä¸ºæœ¬åœ°ç¼“å­˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ª <code>SqlSession</code> å¯¹è±¡ä¼šä½¿ç”¨ä¸€ä¸ª <code>Executor</code> å¯¹è±¡æ¥å®Œæˆä¼šè¯æ“ä½œï¼Œ<code>Executor</code> å¯¹è±¡ä¼šç»´æŠ¤ä¸€ä¸ª Cache ç¼“å­˜ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
<ul><li>ä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ Session ä¼šè¯çº§åˆ«çš„ã€‚</li></ul></li> <li><strong>äºŒçº§ç¼“å­˜æ˜¯ Application åº”ç”¨çº§åˆ«çš„ç¼“å­˜</strong> - ç”¨æˆ·é…ç½®äº† <code>&quot;cacheEnabled=true&quot;</code>ï¼Œæ‰ä¼šå¼€å¯äºŒçº§ç¼“å­˜ã€‚
<ul><li>å¦‚æœå¼€å¯äº†äºŒçº§ç¼“å­˜ï¼Œ<code>SqlSession</code> ä¼šå…ˆä½¿ç”¨ <code>CachingExecutor</code> å¯¹è±¡æ¥å¤„ç†æŸ¥è¯¢è¯·æ±‚ã€‚<code>CachingExecutor</code> ä¼šåœ¨äºŒçº§ç¼“å­˜ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰åŒ¹é…çš„æ•°æ®ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼›å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå†äº¤ç»™çœŸæ­£çš„ <code>Executor</code> å¯¹è±¡æ¥å®ŒæˆæŸ¥è¯¢ï¼Œä¹‹å <code>CachingExecutor</code> ä¼šå°†çœŸæ­£ <code>Executor</code> è¿”å›çš„æŸ¥è¯¢ç»“æœæ”¾ç½®åˆ°ç¼“å­˜ä¸­ï¼Œç„¶ååœ¨è¿”å›ç»™ç”¨æˆ·ã€‚</li> <li>äºŒçº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸæ˜¯åº”ç”¨çº§åˆ«çš„ã€‚</li></ul></li></ul></li></ul> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512185709.png" alt=""></p> <h2 id="_4-sqlsession-å†…éƒ¨å·¥ä½œæœºåˆ¶"><a href="#_4-sqlsession-å†…éƒ¨å·¥ä½œæœºåˆ¶" class="header-anchor">#</a> 4. SqlSession å†…éƒ¨å·¥ä½œæœºåˆ¶</h2> <p>ä»å‰æ–‡ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ï¼ŒMybatis å°è£…äº†å¯¹æ•°æ®åº“çš„è®¿é—®ï¼ŒæŠŠå¯¹æ•°æ®åº“çš„ä¼šè¯å’Œäº‹åŠ¡æ§åˆ¶æ”¾åˆ°äº† SqlSession å¯¹è±¡ä¸­ã€‚é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æºç è§£è¯»æ¥è¿›è¡Œåˆ†æã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512173437.png" alt=""></p> <p><code>SqlSession</code> å¯¹äº insertã€updateã€deleteã€select çš„å†…éƒ¨å¤„ç†æœºåˆ¶åŸºæœ¬ä¸Šå¤§åŒå°å¼‚ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»¥ä¸€æ¬¡å®Œæ•´çš„ select æŸ¥è¯¢æµç¨‹ä¸ºä¾‹è®²è§£ <code>SqlSession</code> å†…éƒ¨çš„å·¥ä½œæœºåˆ¶ã€‚ç›¸ä¿¡è¯»è€…å¦‚æœç†è§£äº† select çš„å¤„ç†æµç¨‹ï¼Œå¯¹äºå…¶ä»– CRUD æ“ä½œä¹Ÿèƒ½åšåˆ°ä¸€é€šç™¾é€šã€‚</p> <h3 id="_4-1-sqlsession-å­ç»„ä»¶"><a href="#_4-1-sqlsession-å­ç»„ä»¶" class="header-anchor">#</a> 4.1. SqlSession å­ç»„ä»¶</h3> <p>å‰é¢çš„å†…å®¹å·²ç»ä»‹ç»äº†ï¼šSqlSession æ˜¯ Mybatis çš„é¡¶å±‚æ¥å£ï¼Œå®ƒæä¾›äº†æ‰€æœ‰æ‰§è¡Œè¯­å¥ï¼Œè·å–æ˜ å°„å™¨å’Œç®¡ç†äº‹åŠ¡ç­‰æ–¹æ³•ã€‚</p> <p>å®é™…ä¸Šï¼ŒSqlSession æ˜¯é€šè¿‡èšåˆå¤šä¸ªå­ç»„ä»¶ï¼Œè®©æ¯ä¸ªå­ç»„ä»¶è´Ÿè´£å„è‡ªåŠŸèƒ½çš„æ–¹å¼ï¼Œå®ç°äº†ä»»åŠ¡çš„ä¸‹å‘ã€‚</p> <p>åœ¨äº†è§£å„ä¸ªå­ç»„ä»¶å·¥ä½œæœºåˆ¶å‰ï¼Œå…ˆè®©æˆ‘ä»¬ç®€å•è®¤è¯†ä¸€ä¸‹ SqlSession çš„æ ¸å¿ƒå­ç»„ä»¶ã€‚</p> <h4 id="executor"><a href="#executor" class="header-anchor">#</a> Executor</h4> <p>Executor å³æ‰§è¡Œå™¨ï¼Œå®ƒè´Ÿè´£ç”ŸæˆåŠ¨æ€ SQL ä»¥åŠç®¡ç†ç¼“å­˜ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512150000.png" alt=""></p> <ul><li><code>Executor</code> å³æ‰§è¡Œå™¨æ¥å£ã€‚</li> <li><code>BaseExecutor</code> æ˜¯ <code>Executor</code> çš„æŠ½è±¡ç±»ï¼Œå®ƒé‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå†…ç½®äº†ä¸€äº›å…±æ€§æ–¹æ³•ï¼Œè€Œå°†å®šåˆ¶åŒ–æ–¹æ³•ç•™ç»™å­ç±»å»å®ç°ã€‚</li> <li><code>SimpleExecutor</code> æ˜¯æœ€ç®€å•çš„æ‰§è¡Œå™¨ã€‚å®ƒåªä¼šç›´æ¥æ‰§è¡Œ SQLï¼Œä¸ä¼šåšé¢å¤–çš„äº‹ã€‚</li> <li><code>BatchExecutor</code> æ˜¯æ‰¹å¤„ç†æ‰§è¡Œå™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯é€šè¿‡æ‰¹å¤„ç†æ¥ä¼˜åŒ–æ€§èƒ½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‰¹é‡æ›´æ–°æ“ä½œï¼Œç”±äºå†…éƒ¨æœ‰ç¼“å­˜æœºåˆ¶ï¼Œä½¿ç”¨å®Œåéœ€è¦è°ƒç”¨ <code>flushStatements</code> æ¥æ¸…é™¤ç¼“å­˜ã€‚</li> <li><code>ReuseExecutor</code> æ˜¯å¯é‡ç”¨çš„æ‰§è¡Œå™¨ã€‚é‡ç”¨çš„å¯¹è±¡æ˜¯ <code>Statement</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ‰§è¡Œå™¨ä¼šç¼“å­˜åŒä¸€ä¸ª SQL çš„ <code>Statement</code>ï¼Œé¿å…é‡å¤åˆ›å»º <code>Statement</code>ã€‚å…¶å†…éƒ¨çš„å®ç°æ˜¯é€šè¿‡ä¸€ä¸ª <code>HashMap</code> æ¥ç»´æŠ¤ <code>Statement</code> å¯¹è±¡çš„ã€‚ç”±äºå½“å‰ <code>Map</code> åªåœ¨è¯¥ session ä¸­æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨å®Œåéœ€è¦è°ƒç”¨ <code>flushStatements</code> æ¥æ¸…é™¤ Mapã€‚</li> <li><code>CachingExecutor</code> æ˜¯ç¼“å­˜æ‰§è¡Œå™¨ã€‚å®ƒåªåœ¨å¯ç”¨äºŒçº§ç¼“å­˜æ—¶æ‰ä¼šç”¨åˆ°ã€‚</li></ul> <h4 id="statementhandler"><a href="#statementhandler" class="header-anchor">#</a> StatementHandler</h4> <p><code>StatementHandler</code> å¯¹è±¡è´Ÿè´£è®¾ç½® <code>Statement</code> å¯¹è±¡ä¸­çš„æŸ¥è¯¢å‚æ•°ã€å¤„ç† JDBC è¿”å›çš„ resultSetï¼Œå°† resultSet åŠ å·¥ä¸º List é›†åˆè¿”å›ã€‚</p> <p><code>StatementHandler</code> çš„å®¶æ—æˆå‘˜ï¼š</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210512160243.png" alt=""></p> <ul><li><code>StatementHandler</code> æ˜¯æ¥å£ï¼›</li> <li><code>BaseStatementHandler</code> æ˜¯å®ç° <code>StatementHandler</code> çš„æŠ½è±¡ç±»ï¼Œå†…ç½®ä¸€äº›å…±æ€§æ–¹æ³•ï¼›</li> <li><code>SimpleStatementHandler</code> è´Ÿè´£å¤„ç† <code>Statement</code>ï¼›</li> <li><code>PreparedStatementHandler</code> è´Ÿè´£å¤„ç† <code>PreparedStatement</code>ï¼›</li> <li><code>CallableStatementHandler</code> è´Ÿè´£å¤„ç† <code>CallableStatement</code>ã€‚</li> <li><code>RoutingStatementHandler</code> è´Ÿè´£ä»£ç† <code>StatementHandler</code> å…·ä½“å­ç±»ï¼Œæ ¹æ® <code>Statement</code> ç±»å‹ï¼Œé€‰æ‹©å®ä¾‹åŒ– <code>SimpleStatementHandler</code>ã€<code>PreparedStatementHandler</code>ã€<code>CallableStatementHandler</code>ã€‚</li></ul> <h4 id="parameterhandler"><a href="#parameterhandler" class="header-anchor">#</a> ParameterHandler</h4> <p><code>ParameterHandler</code> è´Ÿè´£å°†ä¼ å…¥çš„ Java å¯¹è±¡è½¬æ¢ JDBC ç±»å‹å¯¹è±¡ï¼Œå¹¶ä¸º <code>PreparedStatement</code> çš„åŠ¨æ€ SQL å¡«å……æ•°å€¼ã€‚</p> <p><code>ParameterHandler</code> åªæœ‰ä¸€ä¸ªå…·ä½“å®ç°ç±»ï¼Œå³ <code>DefaultParameterHandler</code>ã€‚</p> <h4 id="resultsethandler"><a href="#resultsethandler" class="header-anchor">#</a> ResultSetHandler</h4> <p><code>ResultSetHandler</code> è´Ÿè´£ä¸¤ä»¶äº‹ï¼š</p> <ul><li>å¤„ç† <code>Statement</code> æ‰§è¡Œåäº§ç”Ÿçš„ç»“æœé›†ï¼Œç”Ÿæˆç»“æœåˆ—è¡¨</li> <li>å¤„ç†å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œåçš„è¾“å‡ºå‚æ•°</li></ul> <p><code>ResultSetHandler</code> åªæœ‰ä¸€ä¸ªå…·ä½“å®ç°ç±»ï¼Œå³ <code>DefaultResultSetHandler</code>ã€‚</p> <h4 id="typehandler"><a href="#typehandler" class="header-anchor">#</a> TypeHandler</h4> <p>TypeHandler è´Ÿè´£å°† Java å¯¹è±¡ç±»å‹å’Œ JDBC ç±»å‹è¿›è¡Œç›¸äº’è½¬æ¢ã€‚</p> <h3 id="_4-2-sqlsession-å’Œ-mapper"><a href="#_4-2-sqlsession-å’Œ-mapper" class="header-anchor">#</a> 4.2. SqlSession å’Œ Mapper</h3> <p>å…ˆæ¥å›å¿†ä¸€ä¸‹ Mybatis å®Œæ•´ç¤ºä¾‹ç« èŠ‚çš„ æµ‹è¯•ç¨‹åºéƒ¨åˆ†çš„ä»£ç ã€‚</p> <p>MybatisDemo.java æ–‡ä»¶ä¸­çš„ä»£ç ç‰‡æ®µï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 2. åˆ›å»ºä¸€ä¸ª SqlSession å®ä¾‹ï¼Œè¿›è¡Œæ•°æ®åº“æ“ä½œ</span>
<span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. Mapper æ˜ å°„å¹¶æ‰§è¡Œ</span>
<span class="token class-name">Long</span> params <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">&quot;io.github.dunwu.spring.orm.mapper.UserMapper.selectByPrimaryKey&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;user name: &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¤ºä¾‹ä»£ç ä¸­ï¼Œç»™ sqlSession å¯¹è±¡çš„ä¼ é€’ä¸€ä¸ªé…ç½®çš„ Sql è¯­å¥çš„ Statement Id å’Œå‚æ•°ï¼Œç„¶åè¿”å›ç»“æœ</p> <p><code>io.github.dunwu.spring.orm.mapper.UserMapper.selectByPrimaryKey</code> æ˜¯é…ç½®åœ¨ <code>UserMapper.xml</code> çš„ Statement IDï¼Œparams æ˜¯ SQL å‚æ•°ã€‚</p> <p>UserMapper.xml æ–‡ä»¶ä¸­çš„ä»£ç ç‰‡æ®µï¼š</p> <div class="language-xml extra-class"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectByPrimaryKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select id, name, age, address, email
    from user
    where id = #{id,jdbcType=BIGINT}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Mybatis é€šè¿‡æ–¹æ³•çš„å…¨é™å®šåï¼Œå°† SqlSession å’Œ Mapper ç›¸äº’æ˜ å°„èµ·æ¥ã€‚</p> <h3 id="_4-3-sqlsession-å’Œ-executor"><a href="#_4-3-sqlsession-å’Œ-executor" class="header-anchor">#</a> 4.3. SqlSession å’Œ Executor</h3> <p><code>org.apache.ibatis.session.defaults.DefaultSqlSession</code> ä¸­ <code>selectList</code> æ–¹æ³•çš„æºç ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. æ ¹æ® Statement Idï¼Œåœ¨é…ç½®å¯¹è±¡ Configuration ä¸­æŸ¥æ‰¾å’Œé…ç½®æ–‡ä»¶ç›¸å¯¹åº”çš„ MappedStatement</span>
    <span class="token class-name">MappedStatement</span> ms <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getMappedStatement</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. å°† SQL è¯­å¥äº¤ç”±æ‰§è¡Œå™¨ Executor å¤„ç†</span>
    <span class="token keyword">return</span> executor<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> <span class="token function">wrapCollection</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span>NO_RESULT_HANDLER<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token class-name">ExceptionFactory</span><span class="token punctuation">.</span><span class="token function">wrapException</span><span class="token punctuation">(</span><span class="token string">&quot;Error querying database.  Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¯´æ˜ï¼š</p> <p>Mybatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ <code>Configuration</code> å¯¹è±¡ä¹‹ä¸­ã€‚ä¸­ç»´æŠ¤äº†ä¸€ä¸ª <code>Map&lt;String, MappedStatement&gt;</code> å¯¹è±¡ã€‚å…¶ä¸­ï¼Œkey ä¸º Mapper æ–¹æ³•çš„å…¨é™å®šåï¼ˆå¯¹äºæœ¬ä¾‹è€Œè¨€ï¼Œkey å°±æ˜¯ <code>io.github.dunwu.spring.orm.mapper.UserMapper.selectByPrimaryKey</code> ï¼‰ï¼Œvalue ä¸º <code>MappedStatement</code> å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œä¼ å…¥ Statement Id å°±å¯ä»¥ä» Map ä¸­æ‰¾åˆ°å¯¹åº”çš„ <code>MappedStatement</code>ã€‚</p> <p><code>MappedStatement</code> ç»´æŠ¤äº†ä¸€ä¸ª Mapper æ–¹æ³•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå…¶æ•°æ®ç»„ç»‡å¯ä»¥å‚è€ƒä¸‹é¢çš„ debug æˆªå›¾ï¼š</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210511150650.png" alt=""></p> <blockquote><p>å°ç»“ï¼š</p> <p>é€šè¿‡ &quot;SqlSession å’Œ Mapper&quot; ä»¥åŠ &quot;SqlSession å’Œ Executor&quot; è¿™ä¸¤èŠ‚ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼š</p> <p>SqlSession çš„èŒèƒ½æ˜¯ï¼šæ ¹æ® Statement ID, åœ¨ <code>Configuration</code> ä¸­è·å–åˆ°å¯¹åº”çš„ <code>MappedStatement</code> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>Executor</code> æ¥æ‰§è¡Œå…·ä½“çš„æ“ä½œã€‚</p></blockquote> <h3 id="_4-4-executor-å·¥ä½œæµç¨‹"><a href="#_4-4-executor-å·¥ä½œæµç¨‹" class="header-anchor">#</a> 4.4. Executor å·¥ä½œæµç¨‹</h3> <p>ç»§ç»­ä¸Šä¸€èŠ‚çš„æµç¨‹ï¼Œ<code>SqlSession</code> å°† SQL è¯­å¥äº¤ç”±æ‰§è¡Œå™¨ <code>Executor</code> å¤„ç†ã€‚<code>Executor</code> åˆåšäº†å“ªäº›äº‹å„¿å‘¢ï¼Ÿ</p> <p>ï¼ˆ1ï¼‰æ‰§è¡Œå™¨æŸ¥è¯¢å…¥å£</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
	<span class="token comment">// 1. æ ¹æ®ä¼ å‚ï¼ŒåŠ¨æ€ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œç”¨ BoundSql å¯¹è±¡è¡¨ç¤º</span>
    <span class="token class-name">BoundSql</span> boundSql <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æ ¹æ®ä¼ å‚ï¼Œåˆ›å»ºä¸€ä¸ªç¼“å­˜Key</span>
    <span class="token class-name">CacheKey</span> key <span class="token operator">=</span> <span class="token function">createCacheKey</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>æ‰§è¡Œå™¨æŸ¥è¯¢å…¥å£ä¸»è¦åšä¸¤ä»¶äº‹ï¼š</p> <ul><li><strong>ç”ŸæˆåŠ¨æ€ SQL</strong>ï¼šæ ¹æ®ä¼ å‚ï¼ŒåŠ¨æ€ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œç”¨ BoundSql å¯¹è±¡è¡¨ç¤ºã€‚</li> <li><strong>ç®¡ç†ç¼“å­˜</strong>ï¼šæ ¹æ®ä¼ å‚ï¼Œåˆ›å»ºä¸€ä¸ªç¼“å­˜ Keyã€‚</li></ul> <p>ï¼ˆ2ï¼‰æ‰§è¡Œå™¨æŸ¥è¯¢ç¬¬äºŒå…¥å£</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">CacheKey</span> key<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç•¥</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      queryStack<span class="token operator">++</span><span class="token punctuation">;</span>
      list <span class="token operator">=</span> resultHandler <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> localCache<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// 3. ç¼“å­˜ä¸­æœ‰å€¼ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­å–æ•°æ®ï¼›å¦åˆ™ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleLocallyCachedOutputParameters</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> key<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        list <span class="token operator">=</span> <span class="token function">queryFromDatabase</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      queryStack<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ç•¥</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>å®é™…æŸ¥è¯¢æ–¹æ³•ä¸»è¦çš„èŒèƒ½æ˜¯åˆ¤æ–­ç¼“å­˜ key æ˜¯å¦èƒ½å‘½ä¸­ç¼“å­˜ï¼š</p> <ul><li>å‘½ä¸­ï¼Œåˆ™å°†ç¼“å­˜ä¸­æ•°æ®è¿”å›ï¼›</li> <li>ä¸å‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼š</li></ul> <p>ï¼ˆ3ï¼‰æŸ¥è¯¢æ•°æ®åº“</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryFromDatabase</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">CacheKey</span> key<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    localCache<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> EXECUTION_PLACEHOLDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 4. æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å– List ç»“æœï¼Œå¹¶å°†æŸ¥è¯¢çš„ç»“æœæ›´æ–°æœ¬åœ°ç¼“å­˜ä¸­</span>
      list <span class="token operator">=</span> <span class="token function">doQuery</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      localCache<span class="token punctuation">.</span><span class="token function">removeObject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    localCache<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">getStatementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">StatementType</span><span class="token punctuation">.</span>CALLABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      localOutputParameterCache<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>queryFromDatabase</code> æ–¹æ³•çš„èŒè´£æ˜¯è°ƒç”¨ doQueryï¼Œå‘æ•°æ®åº“å‘èµ·æŸ¥è¯¢ï¼Œå¹¶å°†è¿”å›çš„ç»“æœæ›´æ–°åˆ°æœ¬åœ°ç¼“å­˜ã€‚</p> <p>ï¼ˆ4ï¼‰å®é™…æŸ¥è¯¢æ–¹æ³•</p> <p>SimpleExecutor ç±»çš„ doQuery()æ–¹æ³•å®ç°</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">doQuery</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 5. æ ¹æ®æ—¢æœ‰çš„å‚æ•°ï¼Œåˆ›å»ºStatementHandlerå¯¹è±¡æ¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</span>
      <span class="token class-name">StatementHandler</span> handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 6. åˆ›å»ºjava.Sql.Statementå¯¹è±¡ï¼Œä¼ é€’ç»™StatementHandlerå¯¹è±¡</span>
      stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> ms<span class="token punctuation">.</span><span class="token function">getStatementLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 7. è°ƒç”¨StatementHandler.query()æ–¹æ³•ï¼Œè¿”å›Listç»“æœ</span>
      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> resultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¿°çš„ Executor.query()æ–¹æ³•å‡ ç»è½¬æŠ˜ï¼Œæœ€åä¼šåˆ›å»ºä¸€ä¸ª <code>StatementHandler</code> å¯¹è±¡ï¼Œç„¶åå°†å¿…è¦çš„å‚æ•°ä¼ é€’ç»™ <code>StatementHandler</code>ï¼Œä½¿ç”¨ <code>StatementHandler</code> æ¥å®Œæˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œæœ€ç»ˆè¿”å› List ç»“æœé›†ã€‚
ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>Executor</code> çš„åŠŸèƒ½å’Œä½œç”¨æ˜¯ï¼š</p> <ol><li><p>æ ¹æ®ä¼ é€’çš„å‚æ•°ï¼Œå®Œæˆ SQL è¯­å¥çš„åŠ¨æ€è§£æï¼Œç”Ÿæˆ BoundSql å¯¹è±¡ï¼Œä¾› <code>StatementHandler</code> ä½¿ç”¨ï¼›</p></li> <li><p>ä¸ºæŸ¥è¯¢åˆ›å»ºç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½</p></li> <li><p>åˆ›å»º JDBC çš„ <code>Statement</code> è¿æ¥å¯¹è±¡ï¼Œä¼ é€’ç»™ <code>StatementHandler</code> å¯¹è±¡ï¼Œè¿”å› List æŸ¥è¯¢ç»“æœã€‚</p></li></ol> <p>prepareStatement() æ–¹æ³•çš„å®ç°ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token keyword">private</span> <span class="token class-name">Statement</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">StatementHandler</span> handler<span class="token punctuation">,</span> <span class="token class-name">Log</span> statementLog<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Statement</span> stmt<span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span>statementLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> transaction<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¯¹åˆ›å»ºçš„Statementå¯¹è±¡è®¾ç½®å‚æ•°ï¼Œå³è®¾ç½®SQL è¯­å¥ä¸­ ? è®¾ç½®ä¸ºæŒ‡å®šçš„å‚æ•°</span>
    handler<span class="token punctuation">.</span><span class="token function">parameterize</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> stmt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>å¯¹äº JDBC çš„ <code>PreparedStatement</code> ç±»å‹çš„å¯¹è±¡ï¼Œåˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ SQL è¯­å¥å­—ç¬¦ä¸²ä¼šåŒ…å« è‹¥å¹²ä¸ª? å ä½ç¬¦ï¼Œæˆ‘ä»¬å…¶åå†å¯¹å ä½ç¬¦è¿›è¡Œè®¾å€¼ã€‚</p> <h3 id="_4-5-statementhandler-å·¥ä½œæµç¨‹"><a href="#_4-5-statementhandler-å·¥ä½œæµç¨‹" class="header-anchor">#</a> 4.5. StatementHandler å·¥ä½œæµç¨‹</h3> <p><code>StatementHandler</code> æœ‰ä¸€ä¸ªå­ç±» <code>RoutingStatementHandler</code>ï¼Œå®ƒè´Ÿè´£ä»£ç†å…¶ä»– <code>StatementHandler</code> å­ç±»çš„å·¥ä½œã€‚</p> <p>å®ƒä¼šæ ¹æ®é…ç½®çš„ <code>Statement</code> ç±»å‹ï¼Œé€‰æ‹©å®ä¾‹åŒ–ç›¸åº”çš„ <code>StatementHandler</code>ï¼Œç„¶åç”±å…¶ä»£ç†å¯¹è±¡å®Œæˆå·¥ä½œã€‚</p> <p>ã€æºç ã€‘RoutingStatementHandler</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">RoutingStatementHandler</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">getStatementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> STATEMENT<span class="token operator">:</span>
      delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> PREPARED<span class="token operator">:</span>
      delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreparedStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> CALLABLE<span class="token operator">:</span>
      delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallableStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown statement type: &quot;</span> <span class="token operator">+</span> ms<span class="token punctuation">.</span><span class="token function">getStatementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ã€æºç ã€‘<code>RoutingStatementHandler</code> çš„ <code>parameterize</code> æ–¹æ³•æºç </p> <p>ã€æºç ã€‘<code>PreparedStatementHandler</code> çš„ <code>parameterize</code> æ–¹æ³•æºç </p> <p><code>StatementHandler</code> ä½¿ç”¨ <code>ParameterHandler</code> å¯¹è±¡æ¥å®Œæˆå¯¹ <code>Statement</code> çš„èµ‹å€¼ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">parameterize</span><span class="token punctuation">(</span><span class="token class-name">Statement</span> statement<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä½¿ç”¨ ParameterHandler å¯¹è±¡æ¥å®Œæˆå¯¹ Statement çš„è®¾å€¼</span>
  parameterHandler<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">)</span> statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ã€æºç ã€‘<code>StatementHandler</code> çš„ <code>query</code> æ–¹æ³•æºç </p> <p><code>StatementHandler</code> ä½¿ç”¨ <code>ResultSetHandler</code> å¯¹è±¡æ¥å®Œæˆå¯¹ <code>ResultSet</code> çš„å¤„ç†ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Statement</span> statement<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
  <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">)</span> statement<span class="token punctuation">;</span>
  ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ä½¿ç”¨ResultHandleræ¥å¤„ç†ResultSet</span>
  <span class="token keyword">return</span> resultSetHandler<span class="token punctuation">.</span><span class="token function">handleResultSets</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-6-parameterhandler-å·¥ä½œæµç¨‹"><a href="#_4-6-parameterhandler-å·¥ä½œæµç¨‹" class="header-anchor">#</a> 4.6. ParameterHandler å·¥ä½œæµç¨‹</h3> <p>ã€æºç ã€‘<code>DefaultParameterHandler</code> çš„ <code>setParameters</code> æ–¹æ³•</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// parameterMappings æ˜¯å¯¹å ä½ç¬¦ #{} å¯¹åº”å‚æ•°çš„å°è£…</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParameterMapping</span><span class="token punctuation">&gt;</span></span> parameterMappings <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getParameterMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMappings <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterMappings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ParameterMapping</span> parameterMapping <span class="token operator">=</span> parameterMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸å¤„ç†å­˜å‚¨è¿‡ç¨‹ä¸­çš„å‚æ•°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMapping<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">ParameterMode</span><span class="token punctuation">.</span>OUT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Object</span> value<span class="token punctuation">;</span>
          <span class="token class-name">String</span> propertyName <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>boundSql<span class="token punctuation">.</span><span class="token function">hasAdditionalParameter</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// issue #448 ask first for additional params</span>
            <span class="token comment">// è·å–å¯¹åº”çš„å®é™…æ•°å€¼</span>
            value <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getAdditionalParameter</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>typeHandlerRegistry<span class="token punctuation">.</span><span class="token function">hasTypeHandler</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> parameterObject<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–å¯¹è±¡ä¸­ç›¸åº”çš„å±æ€§æˆ–æŸ¥æ‰¾ Map å¯¹è±¡ä¸­çš„å€¼</span>
            <span class="token class-name">MetaObject</span> metaObject <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newMetaObject</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            value <span class="token operator">=</span> metaObject<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token class-name">TypeHandler</span> typeHandler <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">JdbcType</span> jdbcType <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getJdbcType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> jdbcType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jdbcType <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getJdbcTypeForNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// é€šè¿‡ TypeHandler å°† Java å¯¹è±¡å‚æ•°è½¬ä¸º JDBC ç±»å‹çš„å‚æ•°</span>
            <span class="token comment">// ç„¶åï¼Œå°†æ•°å€¼åŠ¨æ€ç»‘å®šåˆ° PreparedStaement ä¸­</span>
            typeHandler<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>ps<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> jdbcType<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TypeException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not set parameters for mapping: &quot;</span> <span class="token operator">+</span> parameterMapping <span class="token operator">+</span> <span class="token string">&quot;. Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-7-resultsethandler-å·¥ä½œæµç¨‹"><a href="#_4-7-resultsethandler-å·¥ä½œæµç¨‹" class="header-anchor">#</a> 4.7. ResultSetHandler å·¥ä½œæµç¨‹</h3> <p><code>ResultSetHandler</code> çš„å®ç°å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šå°† <code>Statement</code> æ‰§è¡Œåçš„ç»“æœé›†ï¼ŒæŒ‰ç…§ <code>Mapper</code> æ–‡ä»¶ä¸­é…ç½®çš„ <code>ResultType</code> æˆ– <code>ResultMap</code> æ¥è½¬æ¢æˆå¯¹åº”çš„ JavaBean å¯¹è±¡ï¼Œæœ€åå°†ç»“æœè¿”å›ã€‚</p> <p>ã€æºç ã€‘<code>DefaultResultSetHandler</code> çš„ <code>handleResultSets</code> æ–¹æ³•</p> <p><code>handleResultSets</code> æ–¹æ³•æ˜¯ <code>DefaultResultSetHandler</code> çš„æœ€å…³é”®æ–¹æ³•ã€‚å…¶å®ç°å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResultSets</span><span class="token punctuation">(</span><span class="token class-name">Statement</span> stmt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
  <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">activity</span><span class="token punctuation">(</span><span class="token string">&quot;handling results&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>mappedStatement<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> multipleResults <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> resultSetCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// ç¬¬ä¸€ä¸ªç»“æœé›†</span>
  <span class="token class-name">ResultSetWrapper</span> rsw <span class="token operator">=</span> <span class="token function">getFirstResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResultMap</span><span class="token punctuation">&gt;</span></span> resultMaps <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getResultMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ¤æ–­ç»“æœé›†çš„æ•°é‡</span>
  <span class="token keyword">int</span> resultMapCount <span class="token operator">=</span> resultMaps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">validateResultMapsCount</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMapCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// éå†å¤„ç†ç»“æœé›†</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>rsw <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> resultMapCount <span class="token operator">&gt;</span> resultSetCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResultMap</span> resultMap <span class="token operator">=</span> resultMaps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resultSetCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">handleResultSet</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMap<span class="token punctuation">,</span> multipleResults<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rsw <span class="token operator">=</span> <span class="token function">getNextResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cleanUpAfterHandlingResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resultSetCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resultSets <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getResultSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSets <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rsw <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> resultSetCount <span class="token operator">&lt;</span> resultSets<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">ResultMapping</span> parentMapping <span class="token operator">=</span> nextResultMaps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resultSets<span class="token punctuation">[</span>resultSetCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parentMapping <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> nestedResultMapId <span class="token operator">=</span> parentMapping<span class="token punctuation">.</span><span class="token function">getNestedResultMapId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultMap</span> resultMap <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getResultMap</span><span class="token punctuation">(</span>nestedResultMapId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">handleResultSet</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMap<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> parentMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      rsw <span class="token operator">=</span> <span class="token function">getNextResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">cleanUpAfterHandlingResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      resultSetCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">collapseSingleResultList</span><span class="token punctuation">(</span>multipleResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-å‚è€ƒèµ„æ–™"><a href="#_5-å‚è€ƒèµ„æ–™" class="header-anchor">#</a> 5. å‚è€ƒèµ„æ–™</h2> <ul><li><strong>å®˜æ–¹</strong> <ul><li><a href="https://github.com/Mybatis/Mybatis-3" target="_blank" rel="noopener noreferrer">Mybatis Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.Mybatis.org/Mybatis-3/" target="_blank" rel="noopener noreferrer">Mybatis å®˜ç½‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>æ–‡ç« </strong> <ul><li><a href="https://blog.csdn.net/luanlouis/article/details/40422941" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ Mybatis åŸç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/tuguangquan/Mybatis" target="_blank" rel="noopener noreferrer">Mybatis æºç ä¸­æ–‡æ³¨é‡Š<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5cee8b61e51d455d88219ea4" target="_blank" rel="noopener noreferrer">Mybatis ä¸­å¼ºå¤§çš„ resultMap<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.56355bfb.js" defer></script><script src="/assets/js/2.63cce038.js" defer></script><script src="/assets/js/14.b06c49c3.js" defer></script>
  </body>
</html>
